syntax = "proto3";

package device.v1;
option go_package = "github.com/emil-j-olsson/ubiquiti/device/proto/device/v1;devicev1";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";

service Device {
    rpc GetHealth(GetHealthRequest) returns (GetHealthResponse) {
        option (google.api.http) = {
            get: "/v1/health"
        };
    }
    rpc GetDiagnostics(DiagnosticsRequest) returns (DiagnosticsResponse) {
        option (google.api.http) = {
            get: "/v1/diagnostics"
        };
    }
    rpc StreamDiagnostics(DiagnosticsRequest) returns (stream DiagnosticsResponse) {
        option (google.api.http) = {
            get: "/v1/diagnostics/stream"
        };
    }
    rpc UpdateDevice(UpdateDeviceRequest) returns (UpdateDeviceResponse) {
        option (google.api.http) = {
            patch: "/v1/device"
            body: "*"
        };
    }
}

enum Protocol {
    PROTOCOL_UNSPECIFIED = 0;
    PROTOCOL_HTTP = 1;
    PROTOCOL_HTTP_STREAM = 2;
    PROTOCOL_GRPC = 3;
    PROTOCOL_GRPC_STREAM = 4;
}

enum DeviceStatus {
    DEVICE_STATUS_UNSPECIFIED = 0;
    DEVICE_STATUS_HEALTHY = 1;
    DEVICE_STATUS_DEGRADED = 2;
    DEVICE_STATUS_ERROR = 3;
    DEVICE_STATUS_MAINTENANCE = 4;
    DEVICE_STATUS_BOOTING = 5;
}

message GetHealthRequest {}

message GetHealthResponse {
    google.protobuf.Timestamp updated_at = 1 [json_name="updated_at"];
    string device_id = 2 [json_name="device_id"];
    repeated Protocol supported_protocols = 3 [json_name="supported_protocols"];
    string architecture = 4;
    string os = 5;
}

message DiagnosticsRequest {}

message DiagnosticsResponse {
    google.protobuf.Timestamp timestamp = 1;
    string device_id = 2 [json_name="device_id"];
    string hardware_version = 3 [json_name="hardware_version"];
    string software_version = 4 [json_name="software_version"];
    string firmware_version = 5 [json_name="firmware_version"];
    double cpu_usage = 6 [json_name="cpu_usage"];
    double memory_usage = 7 [json_name="memory_usage"];
    DeviceStatus device_status = 8 [json_name="device_status"];
    string checksum = 9;
}

message UpdateDeviceRequest {
    DeviceStatus device_status = 1 [json_name="device_status"];
}

message UpdateDeviceResponse {}